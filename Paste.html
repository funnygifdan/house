<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FunCryptology — Cabin Flow (All-in-One)</title>
<style>
/* ====== Base ====== */
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:#000;color:#eee;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
a{color:#fff;text-decoration:none}
button{cursor:pointer}

/* ====== Stage Layout ====== */
.stage{position:relative;height:100vh;user-select:none;overflow:hidden}
.bg{position:absolute;inset:0}
.bg::before{
  content:""; position:absolute; inset:0;
  background: radial-gradient(120% 90% at 50% 20%, #0a0 0%, #030 22%, #010 60%, #000 100%);
  opacity:.66;
}
.step-1{background:linear-gradient(#021,#010)}
.step-2{background:linear-gradient(#032,#021)}
.step-3{background:linear-gradient(#043,#032)}
.fade{animation:fade .45s ease both}
@keyframes fade{from{opacity:0}to{opacity:1}}
.hint{position:absolute;left:50%;bottom:5vh;transform:translateX(-50%);
  padding:.35rem .6rem;background:rgba(0,0,0,.5);border:1px solid #333;border-radius:.4rem;font-size:.9rem}

/* ====== Path “Tap to advance” ====== */
.tapTarget{
  position:absolute; inset:0;
  background:radial-gradient(80% 50% at 50% 75%, rgba(255,255,255,.05), transparent 60%);
}

/* ====== Door ====== */
.door{position:absolute;left:50%;top:48%;transform:translate(-50%,-50%);
  background:transparent;border:none;width:min(42vw,380px);height:min(56vh,520px);display:grid;place-items:stretch}
.door-panel{position:relative; inset:0; background:linear-gradient(180deg,#210,#110);
  border-radius:.5rem; box-shadow:inset 0 0 28px rgba(0,0,0,.85), 0 24px 60px rgba(0,0,0,.5)}
.door-frame{position:absolute;inset:-8px;border:4px solid #431;border-radius:.6rem;pointer-events:none}
.knob{position:absolute;right:10%;top:50%;width:16px;height:16px;border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #d9c08a, #6b5428)}
.shake{animation:shake .4s ease}
@keyframes shake{10%,90%{transform:translate(-50%,-50%) translateX(-1px)}
20%,80%{transform:translate(-50%,-50%) translateX(2px)}
30%,50%,70%{transform:translate(-50%,-50%) translateX(-4px)}
40%,60%{transform:translate(-50%,-50%) translateX(4px)}}

/* ====== Inside Room ====== */
.room{position:absolute;inset:0}
.room-bg{position:absolute;inset:0;
  background:
    radial-gradient(140% 100% at 50% -20%, rgba(255,255,255,.08), transparent 60%),
    linear-gradient(180deg,#010,#000 40%,#111 41%,#000 70%)}
.shelf-label{position:absolute;left:50%;top:7vh;transform:translateX(-50%);opacity:.75;font-size:.95rem}
.hotspot{position:absolute;display:inline-block;padding:.55rem .75rem;background:rgba(0,0,0,.55);
  border:1px solid #444;border-radius:.45rem;text-decoration:none;color:#fff;backdrop-filter:blur(4px)}
.hotspot:hover{background:rgba(20,20,20,.7)}

/* ====== Optional Embed Panel (iframe) ====== */
#book-frame-wrap{position:absolute;inset:6vh 6vw;background:#000;border:1px solid #333;border-radius:.6rem;
  box-shadow:0 10px 40px rgba(0,0,0,.7)}
#book-frame{width:100%;height:100%;border:0;border-radius:.6rem}
.close{position:absolute;top:.6rem;right:.6rem;z-index:2;background:#111;border:1px solid #444;color:#eee;
  padding:.2rem .5rem;border-radius:.35rem}
.tiny{position:absolute;right:1rem;top:1rem;font-size:.8rem;background:#111;border:1px solid #333;
  color:#eee;padding:.25rem .5rem;border-radius:.35rem}

/* ====== Sidewalk (visual layer at bottom outside) ====== */
.sidewalk{position:absolute;left:0;right:0;bottom:0;height:18vh;
  background:
    repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 14px, rgba(255,255,255,.04) 14px 28px),
    linear-gradient(#222,#141414);
  border-top:1px solid #2b2b2b;
  box-shadow:0 -18px 40px rgba(0,0,0,.6) inset;
  opacity:.9;
}

/* ====== Debug HUD (toggleable) ====== */
.hud{position:absolute;left:1rem;top:1rem;opacity:.7;font:12px/1.3 monospace}
.hud .row{margin-bottom:.25rem}
.hud input[type=checkbox]{vertical-align:middle}
</style>
</head>
<body>
  <div class="stage" id="stage">
    <!-- OUTSIDE: background steps -->
    <div id="bg" class="bg step-1"></div>
    <div class="sidewalk" aria-hidden="true"></div>
    <div id="tap" class="tapTarget" aria-label="Tap to move forward"></div>

    <!-- DOOR -->
    <button id="door" class="door" aria-label="Open door" hidden>
      <div id="doorPanel" class="door-panel">
        <div class="knob" aria-hidden="true"></div>
      </div>
      <div class="door-frame"></div>
    </button>

    <!-- INSIDE ROOM -->
    <div id="room" class="room" hidden>
      <div class="room-bg"></div>
      <div class="shelf-label">Bookshelf</div>

      <!-- Hotspots (positioned in VW/VH so it adapts to screens) -->
      <a class="hotspot" style="left:62vw;top:58vh" href="kids-book/">Kids Book</a>
      <a class="hotspot" style="left:20vw;top:58vh" href="adult-book/">Adult / Scary Book</a>
      <a class="hotspot" style="left:41vw;top:72vh" href="learners-book/">Master Learner’s Book</a>

      <!-- Optional embed panel (loads kids-book/ inside the room) -->
      <div id="book-frame-wrap" hidden>
        <button id="close-frame" class="close" aria-label="Close book">✕</button>
        <iframe id="book-frame" src="" loading="lazy" title="Book"></iframe>
      </div>
    </div>

    <!-- Hint -->
    <div id="hint" class="hint">Tap to move forward</div>

    <!-- Optional: quick toggle to open Kids Book embedded -->
    <button id="open-embed" class="tiny" hidden>Open Kids Book (Embed)</button>

    <!-- Tiny HUD -->
    <div class="hud" id="hud">
      <div class="row">State: <span id="stateVal">outside-0</span></div>
      <label class="row"><input id="embedMode" type="checkbox"> Click “Kids Book” opens as embed</label>
    </div>
  </div>

<script>
/* ====== Cabin Flow Logic (All-in-One) ====== */
(function(){
  const $ = s => document.querySelector(s);
  const bg   = $("#bg");
  const tap  = $("#tap");
  const door = $("#door");
  const panel= $("#doorPanel");
  const room = $("#room");
  const hint = $("#hint");
  const stateVal = $("#stateVal");
  const openEmbedBtn = $("#open-embed");
  const embedToggle = $("#embedMode");
  const frameWrap = $("#book-frame-wrap");
  const frame = $("#book-frame");
  const closeFrame = $("#close-frame");

  // 0..2 = outside path steps, 3 = door shown (closed), 4 = door open, 5 = inside room
  let state = 0;

  function setPathStep(i){
    state = i;
    bg.className = "bg step-" + (i+1);
    bg.classList.add("fade");
    setTimeout(()=>bg.classList.remove("fade"), 450);
    hint.textContent = (i < 2) ? "Tap to move forward" : "Tap the door";
    if (i === 2) door.hidden = false;
    updateHUD();
  }

  function openDoor(){
    panel.style.background = "linear-gradient(180deg,#532,#310)";
    door.classList.add("shake");
    setTimeout(()=>door.classList.remove("shake"), 420);
    state = 4;
    hint.textContent = "Enter the house";
    updateHUD();
  }

  function enterRoom(){
    door.hidden = true;
    room.hidden = false;
    room.classList.add("fade");
    state = 5;
    hint.textContent = "Explore the room";
    openEmbedBtn.hidden = false; // quick demo button
    updateHUD();
  }

  function updateHUD(){
    const labels = ["outside-0","outside-1","outside-2","door-closed","door-open","inside"];
    stateVal.textContent = labels[state] || String(state);
  }

  // Clicks
  tap.addEventListener("click", ()=>{
    if (state <= 1) { setPathStep(state+1); return; }
    if (state === 2) { state = 3; hint.textContent = "Tap the door"; updateHUD(); return; }
  });

  door.addEventListener("click", ()=>{
    if (state === 3) { openDoor(); return; }
    if (state === 4) { enterRoom(); return; }
  });

  // Optional embed button
  openEmbedBtn.addEventListener("click", (e)=>{
    e.stopPropagation();
    frame.src = "kids-book/"; // same-origin relative
    frameWrap.hidden = false;
  });

  closeFrame.addEventListener("click", ()=>{
    frameWrap.hidden = true;
    frame.src = "";
  });

  // Make "Kids Book" open embedded if toggle is on
  room.addEventListener("click", (e)=>{
    const a = e.target.closest("a.hotspot");
    if (!a) return;
    if (embedToggle.checked && a.getAttribute("href") === "kids-book/"){
      e.preventDefault();
      frame.src = "kids-book/";
      frameWrap.hidden = false;
    }
  });

  // Boot
  setPathStep(0);
})();
</script>
</body>
</html>